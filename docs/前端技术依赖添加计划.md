# 前端技术依赖添加计划

## 概述

本文档详细说明在番茄时钟项目中添加前端技术依赖的具体步骤和验证方法。

## TODO LIST
- 注意： 每一步骤完成要让我手动验证。
- 每一步你需要不回测试组件，并提供测试步骤说明
☒ 分析当前项目状态 - Pinia 已实现，其他依赖待添加
☒ 拆分 App.vue 文件 - 创建独立的组件
☒ 添加 Lucide Vue 图标库依赖
☒ 添加 dayjs 日期时间处理依赖
☒ 添加 localforage 本地存储依赖
☐ 配置 Lucide Vue 图标库
☐ 创建 dayjs 时间处理工具函数
☐ 创建 localforage 存储服务
☐ 集成 localforage 到 Pinia store
☐ 更新组件使用 Lucide 图标
☐ 更新组件使用 dayjs 时间格式化
☐ 验证所有依赖集成正常工作

## 依赖清单

### 核心依赖
- **Pinia** - 状态管理
- **Lucide Vue** - 图标库
- **dayjs** - 日期时间处理
- **localforage** - 本地存储

## 1. Pinia 状态管理

### 添加步骤

#### 1.1 安装 Pinia
```bash
pnpm add pinia
```

#### 1.2 配置 Pinia
在 `src/main.ts` 中添加 Pinia 配置：

```typescript
import { createApp } from 'vue'
import { createPinia } from 'pinia'
import App from './App.vue'

const app = createApp(App)
const pinia = createPinia()

app.use(pinia)
app.mount('#app')
```

#### 1.3 创建状态管理文件
创建 `src/stores/timerStore.js`：

```javascript
import { defineStore } from 'pinia'

export const useTimerStore = defineStore('timer', {
  state: () => ({
    currentTime: 25 * 60, // 25分钟
    isRunning: false,
    mode: 'pomodoro', // pomodoro, shortBreak, longBreak
    settings: {
      pomodoroTime: 25,
      shortBreakTime: 5,
      longBreakTime: 15
    }
  }),
  actions: {
    startTimer() {
      this.isRunning = true
    },
    pauseTimer() {
      this.isRunning = false
    },
    resetTimer() {
      this.isRunning = false
      this.currentTime = this.settings.pomodoroTime * 60
    }
  }
})
```

#### 1.4 在组件中使用
在需要使用状态的组件中：

```vue
<script setup>
import { useTimerStore } from '@/stores/timerStore'

const timerStore = useTimerStore()
</script>

<template>
  <div>{{ timerStore.currentTime }}</div>
  <button @click="timerStore.startTimer">开始</button>
</template>
```

### 验证步骤

#### 1.5 基础验证
- 运行 `pnpm dev` 确保应用启动正常
- 检查控制台是否有错误信息
- 确认 Pinia DevTools 在浏览器开发者工具中可用

#### 1.6 功能验证
- 在组件中访问状态数据
- 测试状态修改功能
- 验证状态在不同组件间的同步

## 2. Lucide Vue 图标库

### 添加步骤

#### 2.1 安装 Lucide Vue
```bash
pnpm add lucide-vue-next
```

#### 2.2 全局注册（可选）
在 `src/main.ts` 中注册：

```typescript
import * as LucideIcons from 'lucide-vue-next'

// 全局注册所有图标
Object.entries(LucideIcons).forEach(([name, component]) => {
  app.component(name, component)
})
```

#### 2.3 按需导入使用
在组件中按需导入：

```vue
<script setup>
import { Play, Pause, RotateCcw } from 'lucide-vue-next'
</script>

<template>
  <button>
    <Play :size="24" :stroke-width="2" />
  </button>
</template>
```

### 验证步骤

#### 2.4 基础验证
- 运行 `pnpm dev` 确保应用启动正常
- 检查图标是否正确渲染
- 验证图标属性（大小、颜色等）是否生效

#### 2.5 功能验证
- 测试动态属性绑定
- 验证图标在不同主题下的显示
- 检查图标组件的性能表现

## 3. dayjs 日期时间处理

### 添加步骤

#### 3.1 安装 dayjs
```bash
pnpm add dayjs
```

#### 3.2 创建工具函数
创建 `src/utils/timeUtils.js`：

```javascript
import dayjs from 'dayjs'
import duration from 'dayjs/plugin/duration'

dayjs.extend(duration)

export function formatTime(seconds) {
  const duration = dayjs.duration(seconds, 'seconds')
  const minutes = duration.minutes()
  const secs = duration.seconds()
  return `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`
}

export function getDuration(minutes) {
  return dayjs.duration(minutes, 'minutes').asSeconds()
}
```

#### 3.3 在组件中使用
```vue
<script setup>
import { formatTime } from '@/utils/timeUtils'
import { computed } from 'vue'

const props = defineProps({
  seconds: {
    type: Number,
    required: true
  }
})

const formattedTime = computed(() => formatTime(props.seconds))
</script>

<template>
  <div>{{ formattedTime }}</div>
</template>
```

### 验证步骤

#### 3.4 基础验证
- 运行 `pnpm dev` 确保应用启动正常
- 测试时间格式化功能
- 验证时间计算准确性

#### 3.5 功能验证
- 测试边界情况（0秒、负数等）
- 验证不同格式的输出
- 检查性能表现

## 4. localforage 本地存储

### 添加步骤

#### 4.1 安装 localforage
```bash
pnpm add localforage
```

#### 4.2 创建存储服务
创建 `src/services/storageService.js`：

```javascript
import localforage from 'localforage'

// 配置存储实例
const taskStore = localforage.createInstance({
  name: 'tomato-timer',
  storeName: 'tasks'
})

const settingsStore = localforage.createInstance({
  name: 'tomato-timer',
  storeName: 'settings'
})

export const storage = {
  // 任务相关
  async getTasks() {
    return await taskStore.getItem('tasks') || []
  },
  
  async saveTasks(tasks) {
    return await taskStore.setItem('tasks', tasks)
  },
  
  async addTask(task) {
    const tasks = await this.getTasks()
    tasks.push(task)
    return await this.saveTasks(tasks)
  },
  
  // 设置相关
  async getSettings() {
    return await settingsStore.getItem('settings') || {
      pomodoroTime: 25,
      shortBreakTime: 5,
      longBreakTime: 15
    }
  },
  
  async saveSettings(settings) {
    return await settingsStore.setItem('settings', settings)
  }
}
```

#### 4.3 在状态管理中集成
修改 `src/stores/timerStore.js`：

```javascript
import { defineStore } from 'pinia'
import { storage } from '@/services/storageService'

export const useTimerStore = defineStore('timer', {
  state: () => ({
    // ... 其他状态
    settings: {
      pomodoroTime: 25,
      shortBreakTime: 5,
      longBreakTime: 15
    }
  }),
  actions: {
    async loadSettings() {
      const settings = await storage.getSettings()
      this.settings = settings
    },
    
    async saveSettings() {
      await storage.saveSettings(this.settings)
    }
  }
})
```

### 验证步骤

#### 4.4 基础验证
- 运行 `pnpm dev` 确保应用启动正常
- 测试数据存储功能
- 验证数据持久化（刷新页面后数据依然存在）

#### 4.5 功能验证
- 测试数据读取和写入
- 验证错误处理（存储空间不足等）
- 检查数据同步性

## 开发工作流程

### 每次依赖添加的流程

1. **计划阶段**
   - 确定要添加的依赖
   - 查看官方文档
   - 制定添加步骤

2. **实施阶段**
   - 安装依赖包
   - 配置相关文件
   - 编写示例代码

3. **自检阶段**
   - 检查语法错误
   - 验证基本功能
   - 确保代码质量

4. **验证阶段**
   - 用户执行 `pnpm dev`
   - 功能测试
   - 性能检查

### 质量检查清单

- [ ] 依赖版本兼容性
- [ ] TypeScript 类型定义
- [ ] 代码格式和规范
- [ ] 错误处理机制
- [ ] 性能影响评估
- [ ] 安全性考虑

### 常见问题处理

#### 版本冲突
- 使用 `pnpm why <package>` 查看依赖关系
- 调整版本号解决冲突
- 使用 `pnpm update` 更新依赖

#### 性能问题
- 检查包大小影响
- 优化按需加载
- 使用代码分割

#### 类型错误
- 安装对应的类型定义包
- 添加必要的类型声明
- 配置 TypeScript 选项

## 总结

按照此计划逐步添加前端技术依赖，确保每个依赖都经过充分验证，保证项目的稳定性和可维护性。每个依赖的添加都应该遵循增量开发的原则，确保代码始终处于可用状态。